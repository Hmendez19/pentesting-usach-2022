#!/bin/bash


function salto_linea(){
    echo 
    echo
}


function elegir_opcion_menu() {
    local prompt="$1" outvar="$2"
    shift
    shift
    local options=("$@") cur=0 count=${#options[@]} index=0
    local esc=$(echo -en "\e") # caché ESC como prueba no permite códigos esc
    printf "$prompt\n"
    while true
    do
        # Enumerar todas las opciones (la lista de opciones está basada en cero)ed)
        index=0 
        for o in "${options[@]}"
        do
            if [ "$index" == "$cur" ]
            then echo -e " >\e[7m$o\e[0m" # Marcar y resaltar la opción actual
            else echo "  $o"
            fi
            index=$(( $index + 1 ))
        done
        read -s -n3 key # # Espera a que la usuario seleccione con la tecla direccinal o enter
        if [[ $key == $esc[A ]] # Flecha direccional arriba
        then cur=$(( $cur - 1 ))
            [ "$cur" -lt 0 ] && cur=0
        elif [[ $key == $esc[B ]]  # Flecha direccional abajo
        then cur=$(( $cur + 1 ))
            [ "$cur" -ge $count ] && cur=$(( $count - 1 ))
        elif [[ $key == "" ]] #Delimitador de lectura - ENTER
        then break
        fi
        echo -en "\e[${count}A" # sube al principio para volver a visualizar
    done
    # exportar la selección a la variable de salida solicitada
    printf -v $outvar "${options[$cur]}"
}


function verificar_instalacion_docker(){
    echo "$DIBUJAR_LINEA"
    if ! [ -x "$(command -v docker)" ]; then
    echo 
    echo "$DOCKER_NO_INSTALADO"
    exit
    fi

    if sudo service docker status | grep inactive > /dev/null
    then 
        echo "$DOCKER_DETENIDO"
        echo -n "$DOCKER_INICIAR (y/n)?"
        read respuesta
        if echo "$respuesta" | grep -iq "^y"; then
            sudo service docker start
        fi
    fi
    echo "$DIBUJAR_LINEA"
    salto_linea
}

function pausa(){
    read -p "Presiona cualquier tecla para continuar ..."
}


function ayuda_menu(){
    salto_linea
    echo "$DIBUJAR_LINEA"
    echo "$AYUDA_MENU"
    echo "luego presione ENTER" 
    echo "$DIBUJAR_LINEA"
}


function agregar_host() {
    DIRECCION_IP_DOCKER=$1
    NOMBRE_CONTENEDOR=$2
    AGREGAR_LINEA="$DIRECCION_IP_DOCKER\t$NOMBRE_CONTENEDOR"
    if [ -n "$(grep $2 $RUTA_ARCHIVO_HOST)" ]
        then
            echo "$NOMBRE_CONTENEDOR ya existe en $RUTA_ARCHIVO_HOST"
        else
            echo "NOMBRE DEL CONTENEDOR: $NOMBRE_CONTENEDOR  AGREGADO AL HOSTS";
            sudo -- sh -c -e "echo '$AGREGAR_LINEA' >> /etc/hosts";
    fi
}